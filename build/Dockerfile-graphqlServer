FROM us.icr.io/dia-registry/devops/build-117:latest as build

WORKDIR $GOPATH/src/
COPY ./cmd/http/graphqlServer/ ./
COPY ./cmd/http/graphqlServer/libs/linux/* ./libs/
ENV LD_LIBRARY_PATH=./libs
RUN go mod tidy && CGO_LDFLAGS="-L./libs" go install

FROM gcr.io/distroless/base

COPY --from=build /go/bin/graphqlServer /bin/graphqlServer
COPY ./cmd/http/graphqlServer/schema/ /schema/
COPY ./cmd/http/graphqlServer/libs/linux* /libs/


CMD ["graphqlServer"]

