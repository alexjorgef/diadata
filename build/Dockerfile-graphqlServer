FROM us.icr.io/dia-registry/devops/build-117:latest as build

WORKDIR $GOPATH/src/
COPY ./cmd/http/graphqlServer/ ./
RUN mkdir /go/libs && curl -L https://github.com/zksync-sdk/zksync-crypto-c/releases/download/v0.1.2/zks-crypto-linux-x64.so --output /go/libs/libzks-crypto.so
ENV LD_LIBRARY_PATH=/go/libs
RUN go mod tidy && CGO_LDFLAGS="-L/go/libs" go install


CMD ["/go/bin/graphqlServer"]

